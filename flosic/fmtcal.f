C UTEP Electronic Structure Lab (2019)
C
C THIS IS A COLLECTION OF USEFUL SUBROUTINES THAT WERE
C DEVELOPED AT THE UNIVERSITY OF WISCONSIN BY CC LIN, 
C RA HEATON, JG HARRISON, K MEDNICK, S. CHUNG AND 
C OTHERS PRIOR TO 1981.
      SUBROUTINE FMTCAL(XX,S0,S2,S4,S6,S8)
C DEVELOPED BY S
      IMPLICIT  REAL*8 (A-H,O-Z)
      LOGICAL ONCE
      DIMENSION F(10,161)
      DIMENSION G(20)
      SAVE
      DATA ONCE/.FALSE./
      DATA ROOTPI        /1.77245385090551603D+00/
      DATA C1,C2,C3,C4,C5/1.33333333333333333D+00,
     &                    0.53333333333333333D+00,
     &                    0.15238095238095238D+00,
     &                    3.28125000000000000D+00,
     &                    0.93750000000000000D+00/
      DATA F(1,1)/0.0D0/
C
C        DIFFERENCE BETWEEN DOUBLE $ SINGLE  ARE
C        REAL*8 CARD  $  FORMAT 55  $  COUPOT WORD SIZE
C
      IF(ONCE)GO TO 907
      ONCE=.TRUE.
      EPS=1.0D-12
      DO 110 I=1,10
  110 F(I,1)=1.0D0/(2*I-1)
      T=0.0D0
      DO 200 L=2,161
      T=0.1D0*(L-1)
      X=2.0D0*T
      DEN=39.0D0
      TERM=1.0D0/DEN
      SUM=TERM
      DO 130 I=2,100
      DEN=DEN+2.0D0
      TERM=TERM*X/DEN
      SUM=SUM+TERM
      Q=TERM/SUM
      IF(Q-EPS) 140,140,130
  130 CONTINUE
  140 EX=EXP(-T)
      G(20)=EX*SUM
C
C        USE DOWNWARD RECURSION
C
      DO 150 I=1,19
      K=21-I
      KK=K-1
  150 G(KK)=(X*G(K)+EX)/(2*KK-1)
C
      DO 160 I=1,10
  160 F(I,L)=G(I)
  200 CONTINUE
  907 CONTINUE
C
      T=XX
      IF (T-1.6D+01) 10,10,40
   10 IT=INT(10*T+1.5D0)
      DT=T-0.1D0*(IT-1)
      DO 30 MP1=1,5
      FMT=F(MP1,IT)
      TERM=1.0D0
      DO 20 I=1,5
      TERM=-TERM*DT/I
   20 FMT=FMT+TERM*F(MP1+I,IT)
      GO TO (21,22,23,24,25),MP1
   21 S0=FMT
      GO TO 26
   22 S2=FMT
      GO TO 26
   23 S4=FMT
      GO TO 26
   24 S6=FMT
      GO TO 26
   25 S8=FMT
   26 CONTINUE
   30 CONTINUE
      GO TO 100
C
C CHANGED SIMPLY TO EXP - POREZAG FEB 95
C
   40 IF(T .GT. 80.0D0) GO TO 1090
      POL1=EXP(-T)
      GO TO 1091
1090  POL1=0.0D0
1091  RECT=1.0D0/T
      RT=SQRT(T)
      RTERM=RECT+2.0D0
      PTERM=ROOTPI/RT
      DO 51 MP1=1,5
      GO TO (50,60,70,80,90),MP1
   90 POL2=((RTERM*RECT+C1)*RECT+C2)*RECT+C3
      FMT=C4*RECT*(PTERM/(T*T*T)-POL1*POL2)
      S8=FMT
      GO TO 51
   80 POL2=(RTERM*RECT+C1)*RECT+C2
      FMT=C5*RECT*(PTERM/(T*T)-POL1*POL2)
      S6=FMT
      GO TO 51
   70 POL2=RTERM*RECT+C1
      FMT=0.375D0*RECT*(PTERM/T-POL1*POL2)
      S4=FMT
      GO TO 51
   60 FMT=0.25D0*RECT*(PTERM-POL1*RTERM)
      S2=FMT
      GO TO 51
   50 FMT=0.5D0*RECT*(ROOTPI*RT-POL1)
      S0=FMT
   51 CONTINUE
  100 RETURN
      END
